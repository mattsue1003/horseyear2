<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦¬å¹´ç´…åŒ…å¤§æŒ‘æˆ° - éå¹´å†·çŸ¥è­˜å•ç­”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        :root {
            --primary-red: #b91c1c;
            --gold: #fbbf24;
        }

        body {
            font-family: 'Noto+Sans+TC', sans-serif;
            background: var(--primary-red);
            overflow: hidden;
            height: 100vh;
            margin: 0;
            color: #fff;
            touch-action: manipulation;
        }

        .bg-pattern {
            background-color: #991b1b;
            background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        .envelope {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s;
            user-select: none;
            z-index: 10;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        .envelope:active {
            transform: scale(0.9);
        }

        .slot-machine-container {
            background: linear-gradient(180deg, #ffd700 0%, #ff8c00 100%);
            border: 6px solid #800000;
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 6px 0 #4d0000;
        }

        .slot-window {
            height: 80px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px inset #800000;
        }

        .slot-strip {
            position: absolute;
            top: 0;
            width: 100%;
            transition: top 3s cubic-bezier(0.45, 0.05, 0.55, 0.95);
            display: flex;
            flex-direction: column;
        }

        .slot-item {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: #b91c1c;
            text-align: center;
            padding: 0 10px;
        }

        @keyframes fall {
            0% { transform: translateY(-120px) rotate(0deg); }
            100% { transform: translateY(110vh) rotate(360deg); }
        }

        .modal-backdrop {
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(8px);
        }

        #music-player {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }

        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #fca5a5;
            border-radius: 10px;
        }
        
        /* è¨­è¨ˆè€…æ¨™ç±¤æ¨£å¼ */
        .designer-credit {
            font-size: clamp(10px, 2.5vw, 16px);
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div id="music-container"></div>

    <!-- UI Header -->
    <div class="fixed top-4 left-0 right-0 z-50 flex justify-center px-4">
        <div class="bg-yellow-500 text-red-900 px-6 py-2 rounded-full font-bold shadow-xl border-2 border-red-800 text-sm md:text-base">
            æŒ‘æˆ°é€²åº¦: <span id="solved-count">0</span> / 10 é¡Œ
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-red-900 text-center p-6">
        <div class="max-w-md w-full">
            <div class="mb-4 animate__animated animate__pulse animate__infinite">
                <span class="text-7xl">ğŸ</span>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold text-yellow-400 mb-2 drop-shadow-lg">é¦¬åˆ°æˆåŠŸ</h1>
            <h2 class="text-xl md:text-2xl font-bold text-white mb-8 border-b-2 border-yellow-500 pb-2 inline-block">æ–°æ˜¥ç´…åŒ…å¤§æŒ‘æˆ°</h2>
            <div class="space-y-4 mb-10 text-red-100 text-lg">
                <p>ğŸ§§ é»æ“Šè½ä¸‹çš„ç´…åŒ…å•Ÿå‹•é¡Œç›®</p>
                <p>âœ… ç­”å°æŠ½å–æ–°æ˜¥çé‡‘ç´…åŒ…</p>
                <p>âŒ ç­”éŒ¯æ¥å—çœŸå¿ƒè©±æŒ‘æˆ°</p>
            </div>
            <button onclick="startGame()" class="bg-yellow-400 hover:bg-yellow-300 text-red-900 font-bold text-xl md:text-2xl py-4 px-10 rounded-full transition-all shadow-2xl hover:scale-105 active:scale-95 w-full">
                é»æ“Šé–‹å§‹éŠæˆ²
            </button>
            <p class="mt-4 text-xs text-red-300">æœ¬ç¨‹å¼åŒ…å«èƒŒæ™¯éŸ³æ¨‚</p>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="question-modal" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white text-red-900 w-full max-w-lg rounded-3xl p-6 md:p-8 shadow-2xl relative animate__animated animate__zoomIn max-h-[90vh] flex flex-col">
            <div class="overflow-y-auto custom-scroll pr-2">
                <h2 id="q-text" class="text-xl md:text-2xl font-bold mb-6 text-center leading-snug">è¼‰å…¥ä¸­...</h2>
                <div id="options-container" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="hidden fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4">
        <div class="bg-red-800 text-white w-full max-w-lg rounded-3xl p-6 md:p-8 shadow-2xl animate__animated animate__fadeInUp max-h-[90vh] flex flex-col">
            <div class="overflow-y-auto custom-scroll pr-2">
                <h2 id="result-title" class="text-2xl md:text-3xl font-bold mb-3 text-center text-yellow-400">çµæœæç¤º</h2>
                <div class="bg-red-900/50 rounded-xl p-4 mb-6 border border-red-600">
                    <p id="explanation-text" class="text-base md:text-lg text-center leading-relaxed font-medium">è§£é‡‹å…§å®¹...</p>
                </div>
                
                <div class="slot-machine-container mb-6">
                    <div class="text-center text-red-900 font-bold mb-2 text-[10px] uppercase tracking-widest">
                        <span id="slot-label">æŠ½ç±¤ä¸­...</span>
                    </div>
                    <div class="slot-window">
                        <div id="slot-strip" class="slot-strip" style="top: 0px;"></div>
                    </div>
                </div>

                <button id="next-btn" onclick="closeResultModal()" class="w-full bg-yellow-400 text-red-900 font-bold py-4 rounded-full text-lg shadow-lg hover:bg-yellow-300 transition-colors hidden">
                    ä¸‹ä¸€å€‹ç´…åŒ…
                </button>
            </div>
        </div>
    </div>

    <!-- Final Score -->
    <div id="final-modal" class="hidden fixed inset-0 z-[60] bg-red-900 flex items-center justify-center p-6">
        <div class="text-center max-w-sm">
            <div class="text-8xl mb-6">ğŸ‰</div>
            <h2 class="text-4xl md:text-5xl font-bold text-yellow-400 mb-4">è¬é¦¬å¥”é¨°ï¼</h2>
            <p class="text-xl md:text-2xl text-red-100 mb-8">æ­å–œä½ å®Œæˆäº† 10 é …æŒ‘æˆ°ï¼<br>ç¥ä½ é¦¬å¹´å¤§å‰ï¼Œäº‹äº‹é †å¿ƒï¼</p>
            <button onclick="location.reload()" class="bg-white text-red-900 font-bold py-4 px-10 rounded-full text-xl shadow-xl">
                é‡æ–°æŒ‘æˆ°
            </button>
        </div>
    </div>

    <!-- Designer Credit -->
    <div class="fixed bottom-3 right-3 z-50 text-white/60 designer-credit font-bold select-none pointer-events-none drop-shadow-md">
        è¨­è¨ˆè€… é¾å­Ÿä¿® è·èƒ½æ²»ç™‚å¸«
    </div>

    <script>
        const questions = [
            { 
                q: "ã€Œé¾é¦¬ç²¾ç¥ã€ä¸­çš„ã€Œé¾é¦¬ã€ï¼Œå‚³èªªä¸­æ˜¯ä»€éº¼æ¨£çš„ç”Ÿç‰©ï¼Ÿ", 
                options: ["é•·è‘—é¾è§’çš„é¦¬", "åŠé¾åŠé­šçš„ç¥ç¸", "é•·æœ‰é¾é±—çš„é§¿é¦¬", "è·‘å¾—æ¯”é¾å¿«çš„é¦¬"], 
                correct: 2, 
                exp: "æ­£ç¢ºï¼é¾é¦¬æ˜¯å¤ä»£å‚³èªªä¸­çš„å‰ç¥¥ç¥ç¸ã€‚æ“šã€Šç¦®è¨˜ã€‹è¨˜è¼‰ï¼Œç‰ å¤–å½¢åƒé¦¬ï¼Œèº«ä¸Šé•·æ»¿é¾é±—ã€‚å¤äººç”¨ç‰ ä¾†è±¡å¾µå¥®ç™¼å‘ä¸Šçš„ç²¾ç¥ã€‚" 
            },
            { 
                q: "å¤ä»£å‚³èªªä¸­çš„ã€Œæ±—è¡€å¯¶é¦¬ã€ï¼Œç‰ æµå‡ºçš„æ±—ç‚ºä»€éº¼çœ‹èµ·ä¾†åƒè¡€ï¼Ÿ", 
                options: ["å› ç‚ºæµæ±—æ™‚æœƒæ’å‡ºè¡€æ¶²", "å› ç‚ºçš®è†šè–„ï¼Œè¡€ç®¡æ˜é¡¯ä¸”æ±—æ°´æŠ˜å°„", "å› ç‚ºé¦¬ç”Ÿç—…äº†", "é‚£æ˜¯ç”¨ä¾†æåš‡å¤©æ•µçš„å½è£"], 
                correct: 1, 
                exp: "å°çš„ï¼æ±—è¡€é¦¬ï¼ˆå¤§å®›é¦¬ï¼‰çš®è†šæ¥µè–„ï¼Œå¥”è·‘æ™‚è¡€ç®¡æ“´å¼µï¼ŒåŠ ä¸Šå‡ºæ±—å¾Œçš®æ¯›é¡è‰²åŠ æ·±ï¼Œçœ‹èµ·ä¾†å°±åƒæµè¡€ä¸€æ¨£ã€‚" 
            },
            { 
                q: "åœ¨ç”Ÿè‚–å‚³èªªä¸­ï¼ŒåŸæœ¬è·‘å¾ˆå¿«çš„é¦¬ç‚ºä»€éº¼æ’åœ¨ç¬¬ä¸ƒä½ï¼Ÿ", 
                options: ["å› ç‚ºé¦¬ä¸­é€”å»å–æ°´äº†", "å› ç‚ºè¢«çªç„¶ç«„å‡ºçš„è›‡åš‡åˆ°äº†", "å› ç‚ºè¦ç¦®è®“å¼±å°ç”Ÿè‚–", "å› ç‚ºé¦¬ç¡éé ­äº†"], 
                correct: 1, 
                exp: "ç­”å°äº†ï¼ç›¸å‚³é¦¬æœ¬ä¾†è·‘åœ¨å‰é ­ï¼Œä½†è·¯éæ£®æ—æ™‚è¢«è‰å¢é‘½å‡ºçš„è›‡é©šåš‡ï¼Œå°è‡´ç¯€å¥è®Šäº‚ï¼Œæœ€å¾Œæ‰è½åœ¨ç¬¬ä¸ƒåã€‚" 
            },
            { 
                q: "ã€Œé¦¬åˆ°æˆåŠŸã€é€™å¥æˆèªï¼Œæœ€åˆèˆ‡å“ªä½æ­·å²äººç‰©çš„é§¿é¦¬æœ‰é—œï¼Ÿ", 
                options: ["æ¼¢æ­¦å¸", "æˆå‰æ€æ±—", "å”å¤ªå®—", "ç§¦å§‹çš‡"], 
                correct: 2, 
                exp: "æ­£ç¢ºï¼å”å¤ªå®—æä¸–æ°‘æœ‰å…­åŒ¹è‘—åçš„é§¿é¦¬ï¼ˆæ˜­é™µå…­é§¿ï¼‰ï¼Œä»–é¨è‘—ç‰ å€‘å¹³å®šå¤©ä¸‹ï¼Œæˆ°ç„¡ä¸å‹ï¼Œå¾Œäººä¾¿ç”¨é¦¬åˆ°æˆåŠŸç¥è³€å‡±æ—‹ã€‚" 
            },
            { 
                q: "éå¹´åƒå¹´ç³•çš„ç¿’ä¿—ï¼Œæœ€æ—©çš„å¯“æ„æ˜¯ä»€éº¼ï¼Ÿ", 
                options: ["ç‚ºäº†ç¥­ç¥€ç¶ç¥", "å¯“æ„ã€Œä¸€å¹´æ¯”ä¸€å¹´é«˜ã€", "é é˜²è‚šå­é¤“", "ç‚ºäº†é»ä½å¹´ç¸çš„å˜´"], 
                correct: 1, 
                exp: "æ­£ç¢ºï¼ã€Œå¹´ç³•ã€èˆ‡ã€Œå¹´é«˜ã€è«§éŸ³ï¼Œå¯“æ„ç”Ÿæ´»ä¸€å¹´æ¯”ä¸€å¹´å¥½ï¼Œå°å­©å€‹å­ä¸€å¹´æ¯”ä¸€å¹´é«˜ï¼Œé€™å«ã€Œæ­¥æ­¥é«˜å‡ã€ã€‚" 
            },
            { 
                q: "ã€Œå£“æ­²éŒ¢ã€æœ€åˆä¸¦ä¸æ˜¯çµ¦å°å­©è²·æ±è¥¿çš„éŒ¢ï¼Œè€Œæ˜¯ç‚ºäº†ï¼Ÿ", 
                options: ["ç¹³ç´éå¹´ç¨…é‡‘", "é©…è¶•åç‚ºã€Œç¥Ÿã€çš„å°å¦–", "ä½œç‚ºå„²è“„åŸºé‡‘", "æ‹œè¨ªè¦ªå‹çš„ä¼´æ‰‹ç¦®"], 
                correct: 1, 
                exp: "æ²’éŒ¯ï¼ã€Œæ­²ã€èˆ‡ã€Œç¥Ÿã€è«§éŸ³ã€‚å¤ä»£å‚³èªªæœ‰ä¸€ç¨®å«ã€Œç¥Ÿã€çš„å¦–æ€ªæœƒåœ¨é™¤å¤•æ‘¸å°å­©é ­ï¼Œçˆ¶æ¯åœ¨æ•é‚Šæ”¾éŒ¢æ˜¯ç‚ºäº†é®å£“é‚ªç¥Ÿã€‚" 
            },
            { 
                q: "å‚³çµ±ç¿’ä¿—ä¸­ï¼Œç‚ºä»€éº¼åˆä¸€é€™å¤©åš´ç¦ã€Œæƒåœ°ã€ï¼Ÿ", 
                options: ["å› ç‚ºæƒå¸šç¥åœ¨ä¼‘æ¯", "æ€•æšèµ·ç°å¡µå¼„é«’æ–°è¡£æœ", "æ€•æŠŠå®¶è£¡çš„ã€Œè²¡æ°£ã€æƒå‡ºé–€", "å¤äººç‚ºäº†å·æ‡¶æ‰¾çš„è—‰å£"], 
                correct: 2, 
                exp: "æ­£ç¢ºï¼å¤äººèªç‚ºåˆä¸€å…¨å®¶èšè²¡ï¼Œå¦‚æœé€™å¤©æƒåœ°ï¼ŒæœƒæŠŠä¸€æ•´å¹´çš„å¥½é‹å’Œè²¡å¯Œçµ±çµ±æƒèµ°ã€‚" 
            },
            { 
                q: "å¤§é–€ä¸Šè²¼çš„ã€Œé–€ç¥ã€ï¼Œæœ€å¸¸è¦‹çš„äººç‰©åŸå‹æ˜¯å“ªå…©ä½å°‡è»ï¼Ÿ", 
                options: ["é—œç¾½èˆ‡å¼µé£›", "ç§¦å”å¯¶èˆ‡å°‰é²æ­", "è¶™é›²èˆ‡é¦¬è¶…", "å²³é£›èˆ‡æ–‡å¤©ç¥¥"], 
                correct: 1, 
                exp: "ç­”å°äº†ï¼å”å¤ªå®—æ™šå¹´å¸¸åšå™©å¤¢ï¼Œä¾¿æ´¾å…©å“¡å¤§å°‡ç§¦å”å¯¶èˆ‡å°‰é²æ­å®ˆåœ¨é–€å£ï¼Œæœç„¶å¹³å®‰ç„¡äº‹ï¼Œæ–¼æ˜¯æ°‘é–“é–‹å§‹æµå‚³è²¼å…©äººçš„ç•«åƒã€‚" 
            },
            { 
                q: "ç‚ºä»€éº¼æ˜¥ç¯€ä¸€å®šè¦ã€Œæ”¾é­ç‚®ã€ï¼Ÿ", 
                options: ["ç‚ºäº†è¿æ¥æ˜¥å¤©", "ç‚ºäº†é©…è¶•æ€•å·¨éŸ¿çš„ã€Œå¹´ç¸ã€", "ç‚ºäº†é€šçŸ¥è¦ªå‹é–‹é£¯äº†", "ç‚ºäº†å±•ç¾æŠ€è¡“"], 
                correct: 1, 
                exp: "æ²’éŒ¯ï¼å¹´ç¸å®³æ€•ç«å…‰èˆ‡å·¨å¤§çš„è²éŸ¿ï¼Œæ‰€ä»¥å¤äººé€éç‡’ç«¹å­ç™¼å‡ºçˆ†è£‚è²ï¼ˆçˆ†ç«¹ï¼‰ä¾†é©…é‚ªä¿å¹³å®‰ã€‚" 
            },
            { 
                q: "éå¹´æ™‚ã€Œå€’è²¼ç¦å­—ã€çš„ç”±ä¾†ï¼Œæ“šèªªæ˜¯å› ç‚ºä»€éº¼è«§éŸ³ï¼Ÿ", 
                options: ["ç¦å€’äº† = ç¦åˆ°äº†", "ç¦å€’äº† = ç¦ç™¼äº†", "ç¦å€’äº† = ç¦æ»¿äº†", "é€™ç´”ç²¹æ˜¯è²¼éŒ¯äº†"], 
                correct: 0, 
                exp: "æ­£ç¢ºï¼ã€Œå€’ã€èˆ‡ã€Œåˆ°ã€è«§éŸ³ï¼Œå€’è²¼ç¦å­—ä»£è¡¨ã€Œç¦æ°£å·²åˆ°ã€ã€‚é€™å€‹ç¿’ä¿—æ“šèªªå¾æ¸…ä»£å°±é–‹å§‹æµå‚³äº†ã€‚" 
            }
        ];

        const rewards = ["ğŸ§§ 200 å…ƒ", "ğŸ§§ 600 å…ƒ", "ğŸ§§ 800 å…ƒ", "ğŸ§§ 1000 å…ƒ", "ğŸ§§ 1600 å…ƒ", "ğŸ§§ 2000 å…ƒ"];
        const tasks = [
            "èªªä¸€å€‹æ–°æ˜¥ç¬‘è©±", 
            "åˆ†äº«å»å¹´æœ€æœ‰æ„ç¾©çš„ä¸€ä»¶äº‹", 
            "åˆ†äº«ä¸€å€‹ä¸æ•¢å‘Šäººçš„å°ç§˜å¯†", 
            "èªªå‡ºæœªä¾†ä¸€å¹´æœ€æƒ³åšçš„äº‹", 
            "è·Ÿç¾å ´ä¸€å€‹äººè¡¨é”æ–°å¹´ç¥ç¦", 
            "èªªå‡ºåœ¨å ´ä¸€å€‹äººçš„ä¸‰å€‹å„ªé»"
        ];

        let solvedCount = 0; // ç­”éçš„é¡Œç›®
        let activeEnvelopesInAir = 0; // ç•«é¢ä¸­æ­£åœ¨æ‰è½çš„
        let isGameRunning = false;
        let spawnInterval;
        let musicStarted = false;

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            isGameRunning = true;
            spawnInterval = setInterval(spawnEnvelope, 1000);
            
            if (!musicStarted) {
                const videoId = 'n4Zt4pgScEk';
                const container = document.getElementById('music-container');
                container.innerHTML = `
                    <iframe id="music-player" 
                            src="https://www.youtube.com/embed/${videoId}?autoplay=1&loop=1&playlist=${videoId}&controls=0" 
                            allow="autoplay">
                    </iframe>`;
                musicStarted = true;
            }
        }

        function spawnEnvelope() {
            if (!isGameRunning) return;
            
            // é—œéµé‚è¼¯ï¼šç›®å‰ç•«é¢ä¸­çš„ç´…åŒ… + å·²ç¶“é»éçš„ç´…åŒ…ï¼Œä¸èƒ½è¶…é 10 å€‹
            if (activeEnvelopesInAir + solvedCount >= 10) return;

            activeEnvelopesInAir++;
            const env = document.createElement('div');
            env.className = 'envelope';
            const size = window.innerWidth < 768 ? 55 : 70;
            env.innerHTML = `
                <svg width="${size}" height="${size*1.3}" viewBox="0 0 70 90">
                    <rect width="70" height="90" rx="8" fill="#ef4444" />
                    <rect x="5" y="5" width="60" height="80" rx="6" fill="none" stroke="#fbbf24" stroke-width="2" />
                    <circle cx="35" cy="45" r="18" fill="#fbbf24" opacity="0.1" />
                    <text x="35" y="58" font-family="serif" font-weight="bold" font-size="32" fill="#fbbf24" text-anchor="middle">é¦¬</text>
                </svg>
            `;
            
            const startX = Math.random() * (window.innerWidth - size);
            env.style.left = startX + 'px';
            env.style.top = '-120px';
            
            const duration = window.innerWidth < 768 ? 3.5 + Math.random() * 2 : 5 + Math.random() * 3;
            env.style.animation = `fall ${duration}s linear forwards`;
            
            const clickHandler = (e) => {
                e.stopPropagation();
                activeEnvelopesInAir--; // é»ä¸­ï¼Œç•«é¢ä¸­çš„ç´…åŒ…å°‘ä¸€å€‹
                openQuestion();
                env.remove();
            };

            env.addEventListener('click', clickHandler);
            env.addEventListener('touchstart', (e) => {
                e.preventDefault();
                clickHandler(e);
            }, {passive: false});

            document.body.appendChild(env);

            // ç•¶ç´…åŒ…æ‰å‡ºè¢å¹•ï¼ˆæœªè¢«é»ä¸­ï¼‰
            env.addEventListener('animationend', () => {
                if (document.body.contains(env)) {
                    activeEnvelopesInAir--; // æ‰å‡ºå»äº†ï¼Œåé¡æ­¸é‚„
                    env.remove();
                }
            });
        }

        function openQuestion() {
            if (solvedCount >= 10) return;
            isGameRunning = false;
            const q = questions[solvedCount];
            
            document.getElementById('q-text').innerText = `ã€æŒ‘æˆ° ${solvedCount + 1}ã€‘\n${q.q}`;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-2xl border-2 border-red-100 bg-red-50 hover:bg-red-100 active:bg-yellow-100 transition-colors font-bold text-red-900 shadow-sm text-base md:text-lg";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(idx);
                container.appendChild(btn);
            });
            
            document.getElementById('question-modal').classList.remove('hidden');
        }

        function checkAnswer(selectedIdx) {
            document.getElementById('question-modal').classList.add('hidden');
            const q = questions[solvedCount];
            const isCorrect = selectedIdx === q.correct;
            
            const resultModal = document.getElementById('result-modal');
            const resultTitle = document.getElementById('result-title');
            const expText = document.getElementById('explanation-text');
            const slotLabel = document.getElementById('slot-label');
            
            resultModal.classList.remove('hidden');
            expText.innerText = q.exp;

            if (isCorrect) {
                resultTitle.innerText = "ğŸ‰ ç­”å°äº†ï¼";
                resultTitle.className = "text-3xl font-bold mb-3 text-center text-yellow-400";
                slotLabel.innerText = "ğŸ’° è«‹é»æ“Šé ˜å–çé‡‘ç´…åŒ…";
                startSlotMachine(rewards);
            } else {
                resultTitle.innerText = "ğŸ’¡ ç­”éŒ¯å›‰ï¼";
                resultTitle.className = "text-3xl font-bold mb-3 text-center text-white";
                slotLabel.innerText = "ğŸ² èª å¯¦è±†æ²™åŒ…ï¼šå®ŒæˆçœŸå¿ƒè©±ä»»å‹™";
                startSlotMachine(tasks);
            }
            
            solvedCount++;
            document.getElementById('solved-count').innerText = solvedCount;
        }

        function startSlotMachine(dataList) {
            const strip = document.getElementById('slot-strip');
            const nextBtn = document.getElementById('next-btn');
            nextBtn.classList.add('hidden');
            
            let itemsHTML = '';
            const repeats = 10;
            const totalItems = [];
            for(let i=0; i<repeats; i++) totalItems.push(...dataList);
            
            totalItems.forEach(item => {
                itemsHTML += `<div class="slot-item">${item}</div>`;
            });
            
            strip.innerHTML = itemsHTML;
            strip.style.transition = 'none';
            strip.style.top = '0px';
            strip.offsetHeight; 
            
            const finalIdx = Math.floor(Math.random() * dataList.length);
            const stopPosition = -((repeats - 2) * dataList.length + finalIdx) * 80;
            
            strip.style.transition = 'top 3s cubic-bezier(0.1, 0, 0.1, 1)';
            strip.style.top = stopPosition + 'px';
            
            setTimeout(() => {
                nextBtn.classList.remove('hidden');
            }, 3200);
        }

        function closeResultModal() {
            document.getElementById('result-modal').classList.add('hidden');
            if (solvedCount >= 10) {
                document.getElementById('final-modal').classList.remove('hidden');
                clearInterval(spawnInterval);
            } else {
                isGameRunning = true;
            }
        }

        window.addEventListener('resize', () => {
            document.querySelectorAll('.envelope').forEach(env => env.remove());
            activeEnvelopesInAir = 0;
        });
    </script>
</body>
</html>
